# PurramidTime - Stopwatch - App-Intent Development Specifications
Purramid Time is a classroom management tool that displays three time-keeping app-intents. The stopwatch provides digital time measurement to the centisecond.

## **Order of Presentation**
Stopwatch is the third PurramidTime app-intent

## Technical Implementation Notes
- Service/Activity type: Foreground Service (StopwatchService) + Settings Activity (StopwatchActivity)
- Free-form window support: Yes
- Multi-instance support: Yes (up to 4 simultaneous stopwatches)
- Window tracking: UUID per timer window
- Shares single service: Yes
- Requires permissions:
  - SYSTEM_ALERT_WINDOW (for overlay)
  - FOREGROUND_SERVICE
  - POST_NOTIFICATIONS
  - INTERNET (music access)
  - WAKE_LOCK
  - RECEIVE_BOOT_COMPLETED
- Instance tracking: 
  - Uses standardized instanceId (1-4) pattern
  - Persists with UUID for crash recovery
  - Managed by InstanceManager
- Database entities: TimerStateEntity
- Key dependencies:
  - ViewModels: TimersViewModel
  - DAO: TimerDao
  - Shared: MultiWindowManager


 --- RUNTIME EVENTS ---
(1) On first app-intent launch, the stopwatch opens in a windowed state.
(2) The most recent stopwatch user preferences are saved. Save the following:
	(2.1) Stopwatch size
	(2.2) Background color
	(2.3) Set countdown time
	(2.4) Hundredths toggle state
    (2.5) Lap toggle state
    (2.6) Sounds toggle state
(3) On future app-intent launches, the stopwatch loads saved user preferences.


 --- USER INTERFACE ---
(4) A Settings button is positioned in the bottom left corner.
	(4.1) Default icon state uses ic_settings.xml.
	(4.2) Active state: Programmatically change fill colores as per the Button Iplementation Guidelines.
(5) A Close button is positioned in the top right corner.
	(5.1) Default icon state uses ic_close.xml.
	(5.2) Active state: Programmatically change fill colores as per the Button Iplementation Guidelines.
(6) All stopwatches use a digital clock face HH:MM:SS
    (6.1) Hundredths will be abbreviated as cs (centiseconds) in the instructions, but all user-facing strings say Hundredths.
    (6.2) If Hundredths is toggled on, time displays as HH:MM:SS.cs
        (6.2.1) Hundredths appear 0.6f the size of the other numbers.
        (6.2.2) Hundredths are separated from seconds with a period not a colon.

``BUTTONS``
(7) Below the stopwatch clock is two buttons:
	(7.1) Play/Pause
		(7.1.1) Default state: ic_pause.xml
		(7.1.2) Active state: ic_play.xml
	(7.2) Reset
		(7.2.1) Default state: ic_reset.xml
		(7.2.2) Active state: Programmatically change fill colores as per the Button Iplementation Guidelines.
	(7.3) Play/Pause is on the left, and Reset is on the right.
		(7.3.1) This order is reversed for right-to-left languages.


 --- USER EXPERIENCE ---
(8) ``SETTINGS SUMMARY``
	(8.1) When a user touches the settings button
		(8.1.1) its icon changes from (4.1) Default to (4.2) Active.
		(8.1.2) time is paused if it is actively counting
	(8.2) When activated, a settings window opens with a smooth transition animation, as per the universal specifications.
		(8.2.1) The settings button remains active while the settings window is open.
		(8.2.2) The settings window is rows of strings and an icon:
			(8.2.2.1) "Colors"
				(8.2.2.1.1) Following the word "Color" is a color square
					(8.2.2.1.1.1) The fill for this square is the color current used for the timer background
					(8.2.2.1.1.2) The default color is White.
				(8.2.2.1.2) If the user taps the word "Color" or the color square, a color picker opens.
				(8.2.2.1.3) The color picker displays the six color options from PurramidPalette.kt
					(8.2.2.1.3.1) This color applies to the timer background
					(8.2.2.1.3.2) Timer numbers are either black and white depending on which option creates the best color contrast with the background color.
			(8.2.2.2) "Hundredths"
				(8.2.2.2.1) Following the word "Hundredths" is an on/off toggle.
					(8.2.2.2.1.1) The toggle includes the strings "On" and "Off"
					(8.2.2.2.1.2) The default state is On.
				(8.2.2.2.2) If the setting is toggled on, hundredths are included in the displayed time
				(8.2.2.2.3) If the setting is toggled off, hundredths are not included in the displayed time
			(8.2.2.3) "Lap Time"
				(8.2.2.3.1) Following the phrase "Lap Time" is an on/off toggle.
					(8.2.2.3.1.1) The toggle includes the strings "On" and "Off"
					(8.2.2.3.1.2) The default state is Off.	
				(8.2.2.3.2) If the setting is toggled on
					(8.2.2.3.2.1) a "Lap" button appears beside the reset button
						(8.2.2.3.2.1.1) Default state: ic_lap.xml
						(8.2.2.3.2.1.2) Active state: programatically changes the fill color of the default icon to #808080
			(8.2.2.4) "Sounds"
				(8.2.2.4.1) Following the word "Sounds" is an on/off toggle.
					(8.2.2.4.1.1) The toggle includes the strings "On" and "Off"
					(8.2.2.4.1.2) The default state is Off.	
				(8.2.2.4.2) If the setting is toggled on, a monotone "beep" sound plays for 0.1 seconds every time the play/pause or reset buttons are pressed.
			(8.2.2.5) "Add Another"
				(8.2.2.5.1) Following the phrase "Add Another" is an add icon.
					(8.2.2.5.1.1) Default icon state: ic_add_circle.xml.
					(8.2.2.5.1.2) The active icon state: programatically changes the fill color of the default icon to #808080.
				(8.2.2.5.2) When a user touches the Add Another button
					(8.2.2.5.2.1) its icon changes from Default to Active for the duration of the onTouch event
					(8.2.2.5.2.2) a new timer appears at the geometric center of the screen.
						(8.2.2.5.2.2.1) the new timer is offset 25px to the right and 25px down if a timer already exists at the center of the screen.
						(8.2.2.5.2.2.2) it adopts all the preferences of the timer from which it was opened
							(8.2.2.5.2.2.2.1) For example, a new timer opened from a 300px by 300px stopwatch that has a light blue background would also be a 300px by 300px stopwatch with a light blue background.
					(8.2.2.5.2.3) If four timers already exist on the screen, the Add Another setting is inactivated.


 --- Non-Settings UX ---
(9) ``PLAY/PAUSE``
	(9.1) When a user taps the play/pause button while it is in its default state:
		(9.1.1) the icon changes to its active state
		(9.1.2) the time counting animation stops (is paused)
	(9.2) When a user taps the play/pause button while it is in its active state:
		(9.2.1) the icon changes to its default state
		(9.2.2) time resumes counting (plays) from the point at which it was paused
			
(10) ``LAP``
	(10.1) When a user taps the lap button
		(10.1.1) the icon changes to its active state for the duration of the onTouch event
		(10.1.2) The header string "Lap Times" appears beside the digital clock
		(10.1.3) the time at which the button was pressed is displayed below the header string
			(10.1.3.1) A maximum of ten laps can be displayed
				(10.1.3.1.1) The first lapped time appears on top
				(10.1.3.1.2) Each successive lap is added to the bottom of the list.
				(10.1.3.1.3) When ten lap times are displayed, the lap button becomes inactive.
			(10.1.3.2) Reference "Announce" in the randomizers app-intent for examples of how this text should appear.

(11) ``RESET``
	(11.1) When a user taps the reset button
		(11.1.1) the icon changes to its active state for the duration of the onTouch event
		(11.1.2) a countdown timer resets to the set time
		(11.1.3) a stopwatch resets to 00:00:00.00
			(11.1.3.1) If there were lap times displayed, all lap times are cleared
		(11.1.4) if time was paused
			(11.3.4.1) time remains paused
		(11.1.5) if time was playing
			(11.3.5.1) time continues counting.


(12) TODO: Is "Enable Overlay" implemented correctly? It should be an auto-prompt and not a button.